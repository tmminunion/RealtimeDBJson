{"version":3,"file":"browser.js","sources":["../src/index.js?commonjs-entry","../src/index.js","../node_modules/ws/browser.js"],"sourcesContent":["import { getDefaultExportFromCjs } from \"\u0000commonjsHelpers.js\";\nimport { __require as requireSrc } from \"/data/data/com.termux/files/home/Clientnudb/src/index.js\";\nvar srcExports = requireSrc();\nexport { srcExports as __moduleExports };\nexport default /*@__PURE__*/getDefaultExportFromCjs(srcExports);","class Nudb {\n  constructor(wsUrl, options = {}) {\n    this.wsUrl = wsUrl;\n    this.socket = null;\n    this.listeners = {};\n    this.dataCallbacks = {};\n    this.queue = [];\n    this.headers = options.headers || {};\n    this.connect();\n  }\n\n  connect() {\n    const WebSocketImpl =\n      typeof WebSocket !== \"undefined\"\n        ? WebSocket\n        : require(\"ws\"); // fallback untuk Node.js\n\n    this.socket = new WebSocketImpl(this.wsUrl);\n\n    this.socket.onopen = () => {\n      console.log(\"ðŸŸ¢ WebSocket connected\");\n      while (this.queue.length > 0) {\n        const action = this.queue.shift();\n        this.socket.send(JSON.stringify(action));\n      }\n      Object.keys(this.listeners).forEach((path) => {\n        this.sendMessage({ type: \"subscribe\", path });\n      });\n    };\n\n    this.socket.onmessage = (event) => {\n      try {\n        const msg = JSON.parse(event.data);\n        if (msg.type === \"update\" && this.listeners[msg.path]) {\n          this.listeners[msg.path].forEach((cb) => cb(msg.data));\n        }\n        if (msg.type === \"data\" && this.dataCallbacks[msg.path]) {\n          this.dataCallbacks[msg.path].forEach((cb) => cb(msg.data));\n          delete this.dataCallbacks[msg.path];\n        }\n      } catch (err) {\n        console.error(\"Error parsing message:\", err);\n      }\n    };\n\n    this.socket.onclose = () => {\n      console.warn(\"ðŸ”´ WebSocket disconnected. Reconnecting...\");\n      setTimeout(() => this.connect(), 3000);\n    };\n  }\n\n  _generateId() {\n    const chars =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    let str = \"\";\n    for (let i = 0; i < 17; i++) {\n      str += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return `${Date.now()}${str}`;\n  }\n\n  setHeader(key, value) {\n    this.headers[key] = value;\n  }\n\n  sendMessage(msg) {\n    const fullMsg = { ...msg, headers: this.headers };\n    if (this.socket.readyState === 1) {\n      this.socket.send(JSON.stringify(fullMsg));\n    } else {\n      this.queue.push(fullMsg);\n    }\n  }\n\n  subscribe(path) {\n    this.sendMessage({ type: \"subscribe\", path });\n  }\n\n  on(path, callback) {\n    if (!this.listeners[path]) {\n      this.listeners[path] = [];\n      this.subscribe(path);\n    }\n    this.listeners[path].push(callback);\n  }\n\n  get(path, callback) {\n    if (!this.dataCallbacks[path]) {\n      this.dataCallbacks[path] = [];\n    }\n    this.dataCallbacks[path].push(callback);\n    this.sendMessage({ type: \"get\", path });\n  }\n\n  set(path, data) {\n    this.sendMessage({ type: \"set\", path, data });\n  }\n\n  push(path, data) {\n    const id = this._generateId();\n    this.set(`${path}/${id}`, data);\n    return id;\n  }\n\n  update(path, data) {\n    this.sendMessage({ type: \"update\", path, data });\n  }\n\n  delete(path) {\n    this.sendMessage({ type: \"delete\", path });\n  }\n}\n\nif (typeof window !== \"undefined\") {\n  window.Nudb = Nudb;\n}\n\nmodule.exports = Nudb;","'use strict';\n\nmodule.exports = function () {\n  throw new Error(\n    'ws does not work in the browser. Browser clients must use the native ' +\n      'WebSocket object'\n  );\n};\n"],"names":["srcExports","Nudb","constructor","wsUrl","options","arguments","length","undefined","this","socket","listeners","dataCallbacks","queue","headers","connect","WebSocketImpl","WebSocket","browser","Error","onopen","console","log","action","shift","send","JSON","stringify","Object","keys","forEach","path","sendMessage","type","onmessage","event","msg","parse","data","cb","err","error","onclose","warn","setTimeout","_generateId","chars","str","i","charAt","Math","floor","random","Date","now","setHeader","key","value","fullMsg","readyState","push","subscribe","on","callback","get","set","id","update","delete","window","src","requireSrc","getDefaultExportFromCjs"],"mappings":"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","x_google_ignoreList":[2]}